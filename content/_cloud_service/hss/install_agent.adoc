// 安装主机安全 Agent

// tag::before_install[]
购买授权后，需要在目标主机上安装 Agent，才能正常开启主机的安全保护。

Agent 用于执行检测任务，全量扫描主机，并可实时监测主机的安全状态，并将收集的主机信息上报给管理中心。

// tag::os[]

== 支持的操作系统

主机安全服务的 Agent 支持的操作系统版本如下表所示。

[cols="1,3"]
|===
|操作系统类型|支持情况

|Linux
a| * 支持 Centos5.0+、Redhat5.0+、Suse11+、Ubuntu 14+ 等主流发行版本操作系统。

* 支持中标麒麟、银河麒麟、统信 UOS 等国产系统。

|Windows
a|支持 Windows XP、Windows 7、Windows 8、Windows 10、Windows 11、Windows Server 2003、Windows Server 2008、Windows Server 2008R2、Windows Server 2012、
Windows Server 2016、Windows Server 2019 等版本操作系统。
|===

// end::os[]

== 前提条件

* 已购买云服务器防护授权且未到期。
* 待安装 Agent 的云服务器可正常访问到管理中心的 10571 端口（安全组默认允许访问，如做了改动请修正）。
+
include::../../_components/note.adoc[]
当云服务器与管理中心不在同一个可用区（Zone），云服务器需要通过代理才能访问到管理中心。因此，安装 Agent 时，需要将安装命令中的管理中心 IP 替换为代理 IP。详见安装步骤。
include::../../_components/table_footer.adoc[]


== 注意事项

* 防篡改与云服务器防护共用同一个 Agent，您只需在同一云服务器上安装一次。
* 安装 Agent 的主机总数量不应大于云服务器防护授权总数，当授权数被用完，即便主机已安装 Agent，也无法进行安全防护。未被防护的主机不会显示在管理中心列表的**资产名**列。


// end::before_install[]


== Linux 安装步骤

//tag::linux[]
Linux 系统的云服务器，支持如下安装方式：

* 离线安装：适用于没有安装 wget 命令以及安装中存在 openssl 问题的终端。
* 在线安装：如果可以正常使用 wget 命令，推荐使用在线安装方式。
* 批量安装：通过填写模板文件配置云服务器信息，上传文件后自动进行安装，适合大批量安装。

=== 在线安装

. link:../../manual/login_edr/[登录管理中心控制台]。
. 在左侧导航栏，选择**系统管理**，默认进入**部署管理**的**添加终端**页面。
. 在**Linux 系统**区域，点击**在线安装**右侧的**复制**，复制安装命令。
+
image::/images/cloud_service/security/hss/linux_online_agent.png[]

. 使用 root 用户以命令行方式登录终端服务器，粘贴复制的安装命令，回车执行安装。
+
include::../../_components/note.adoc[]
* ubuntu 系统云服务器以 *ubuntu* 用户登录后，执行 `sudo -i` 切换到 *root* 用户运行安装命令。
* 在线安装命令中的 IP 地址为管理中心 IP 地址，请以实际环境为准。
* 若云服务器与管理中心不在同一个可用区，无法正常通信时，需要通过代理与管理中心通信。因此，安装时，需要将安装命令中的 IP 及端口信息替换为云服务器所属可用区的代理地址。代理地址可在管理中心列表中的**操作**列，点击**代理地址**进行查看。
include::../../_components/table_footer.adoc[]

. 等待命令成功执行后，通过以下方式确认安装成功：
+
* 回到管理中心控制台，在左侧导航栏选择**终端管理** > *终端概况*，可查看到已连接成功的云服务器，确认安装成功。
* 回到主机安全服务控制台，在管理中心列表的**资产名**列，可查看到已安装 Agent 的云服务器 ID。


=== 离线安装

. link:../../manual/login_edr/[登录管理中心控制台]。
. 在左侧导航栏，选择**系统管理**，默认进入**部署管理**的**添加终端**页面。
. 在**Linux 系统**的**离线安装**区域，根据终端服务器操作系统情况，选择**系统架构**及**操作系统位数**，然后点击右侧的**下载**，下载安装包。
+
image::/images/cloud_service/security/hss/linux_offline_agent.png[]

. [[step4]]下载过程中，点击**离线安装**右侧的**复制**，复制安装命令，用户后续在终端服务器上执行。
. 下载完成后，使用文件传输工具（如 Xftp）以 root 用户上传安装包到终端服务器的 `/opt` 目录下。
. 使用 root 用户以命令行方式登录终端服务器后台，粘贴<<step4,步骤4>>中复制的安装命令，回车后执行安装。
+
include::../../_components/note.adoc[]
ubuntu 系统云服务器以 *ubuntu* 用户登录后，执行 `sudo -i` 切换到 *root* 用户运行安装命令。
include::../../_components/table_footer.adoc[]
. 等待命令成功执行后，通过以下方式确认安装成功：
+
* 回到管理中心控制台，在左侧导航栏选择**终端管理** > *终端概况*，可查看到已连接成功的云服务器，确认安装成功。
* 回到主机安全服务控制台，在管理中心列表的**资产名**列，可查看到已安装 Agent 的云服务器 ID。

=== 批量安装

. link:../../manual/login_edr/[登录管理中心控制台]。
. 在左侧导航栏，选择**系统管理**，默认进入**部署管理**的**添加终端**页面。
. 在**Linux 系统**的**批量安装**区域，点击**下载**，下载批量安装模板，用于填写需要安装的主机 IP、端口、用户等信息。
+
image::/images/cloud_service/security/hss/linux_multi_agent.png[]
. 打开模板文件，根据模板示例完成主机相关信息填写。
+
image::/images/cloud_service/security/hss/linux_batch_tmp.png[]
+
* IP 地址：主机 IP 地址。请确保管理中心能与该 IP 成功通信。
* 端口：远程登录端口。
* 用户名：登录用户名。
* 密码：登录密码。

. 填写完成后，点击**上传文件**上传模板文件。
+
上传后，系统自动进行批量安装，您只需等待安装完成即可。

. 等待命令成功执行后，通过以下方式确认安装成功：
+
* 回到管理中心控制台，在左侧导航栏选择**终端管理** > *终端概况*，可查看到已连接成功的云服务器，确认安装成功。
* 回到主机安全服务控制台，在管理中心列表的**资产名**列，可查看到已安装 Agent 的云服务器 ID。

//end::linux[]

== Windows 安装步骤

//tag::windows[]

Windows 系统的云服务器，支持如下安装方式：

* 离线安装
** 下载客户端安装包，拷贝到主机本地进行安装。
** 复制下载链接到主机，本地下载安装包后进行安装。

* 在线安装：Windows 7 及以上版本系统，支持 administrator 角色复制安装命令后在 cmd 下进行一键安装。

=== 在线安装

. link:../../manual/login_edr/[登录管理中心控制台]。
. 在左侧导航栏，选择**系统管理**，默认进入**部署管理**的**添加终端**页面。
. 在 **Windows 系统**区域，点击**在线安装**右侧的**复制**，复制安装命令。
+
image::/images/cloud_service/security/hss/win_online_agent.png[]
. 使用 administrator 用户在 Windows 主机上搜索 “cmd”，找到命令提示符应用，并右键点击该应用，选择**以管理员身份运行**。
. 在打开的 cmd 窗口中，粘贴复制的安装命令，回车后执行安装。
+
include::../../_components/note.adoc[]

* 在线安装命令中的 IP 地址为管理中心 IP 地址，请以实际环境为准。
* 若云服务器与管理中心不在同一个可用区，无法正常通信时，需要通过代理与管理中心通信。因此，安装时，需要将安装命令中的 IP 及端口信息替换为云服务器所属可用区的代理地址。代理地址可在管理中心列表中的**操作**列，点击**代理地址**进行查看。
include::../../_components/table_footer.adoc[]

. 等待命令成功执行后，通过以下方式确认安装成功：
+
* 回到管理中心控制台，在左侧导航栏选择**终端管理** > *终端概况*，可查看到已连接成功的云服务器，确认安装成功。
* 回到主机安全服务控制台，在管理中心列表的**资产名**列，可查看到已安装 Agent 的云服务器 ID。

=== 离线安装

. link:../../manual/login_edr/[登录管理中心控制台]。
. 在左侧导航栏，选择**系统管理**，默认进入**部署管理**的**添加终端**页面。

. 下载 Agent 安装包。
+
image::/images/cloud_service/security/hss/win_offline_agent.png[]
+
* 方式一：在 **Windows 系统**区域，点击**离线安装**右侧的**下载**直接进行下载。下载完成后，以管理身份将安装包拷贝到待安装的主机。
* 方式二：在 **Windows 系统**区域，点击**离线安装**右侧的**复制**，复制安装包下载链接，然后以管理员权限登录待安装的主机，在浏览器地址栏中粘贴链接，下载安装包到本地。

. 在 Windows 主机上，双击安装程序，进入安装程序页面，设置安装目录，点击**开始后装**，等待安装完成。

. 在**安装配置**弹窗中，输入**管理中心地址**、**资产名称**和**管理员识别码**，点击**确定**。
+
* 管理中心地址：下载安装包的管理中心地址。
* 资产名称：当前待安装 Agent 的主机自身的名称。
* 管理识别码：管理中心识别码。在**添加终端**页面可查看和复制该识别码。
+
image::/images/cloud_service/security/hss/win_offline_code.png[]


. 等待命令成功执行后，通过以下方式确认安装成功：
+
* 回到管理中心控制台，在左侧导航栏选择**终端管理** > *终端概况*，可查看到已连接成功的云服务器，确认安装成功。
* 回到主机安全服务控制台，在管理中心列表的**资产名**列，可查看到已安装 Agent 的云服务器 ID。

//end::windows[]


== 常见问题

include::./faq.adoc[tag=agent_install,leveloffset=+1]


