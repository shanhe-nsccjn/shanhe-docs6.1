
//公网连接 FAQ

* <<q1>>
* <<q2>>
* <<q3>>


[#q1]
== 为什么云服务器绑定 EIP 后仍无法通过公网连通？

无法通过 EIP 访问云服务器，可能原因如下：

[cols="1,3"]
|===
|可能原因|排查建议

|被云服务器的安全策略拦截
a| . 请排查云服务器是否绑定安全组。 +
. 请检查安全组规则中是否允许对相关协议或端口的访问。 +
+
* 如果您的云服务器绑定的是默认安全组，那么 ping 和 ssh 所使用的端口默认是放开的，您可以通过 SSH 方式远程登录云服务器，也可以 ping 通云服务器 EIP。
* 如果您的云服务器绑定的是自建安全组，初始状态下，安全组中不包含任何规则，所有端口都是关闭的，故无法连通。您需要建立规则以打开相应的端口。
+
例如：如果您需要访问云服务器的 22 号端口，需要手动为云服务器所在安全组下，添加一条接受 tcp 22 端口的下行规则；如果您想开启 ping 功能，则需要在安全组中添加接受 ICMP echo request 的下行规则。

|EIP 实例欠费
|请排查 EIP 实例是否存在欠费的情况。 +
平台会在欠费前后给您发送短信或邮件提醒。为避免实例欠费对您的服务产生影响，请您及时续费或充值。

|===

[#q2]
== 公网连接的网络延迟增大如何处理？

[discrete]
=== 可能原因

当出现通过云服务器访问互联网或者互联网访问云服务响应慢时，通常有如下原因：

* 正在上传文件到云服务器或者在云服务器从互联网下载数据。
* 云服务器对外提供的业务，有大量流量进出（既有用户在访问您的业务）。

[discrete]
=== 排查建议

. 通过执行以下命令测试公网 IP 的延迟。
+
请将 `<EIP>` 替换为您的实际 EIP 地址。
+
[source,bash]
----
ping <EIP> -t
----
+
返回如下类似信息：
+
[source,shell]
----
正在 Ping 139.x.x.x 具有 32 字节的数据:
来自 139.x.x.x 的回复: 字节=32 时间=163ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=145ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=145ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=138ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=154ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=143ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=139ms TTL=52
来自 139.x.x.x 的回复: 字节=32 时间=139ms TTL=52

139.x.x.x 的 Ping 统计信息:
    数据包: 已发送 = 8，已接收 = 8，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 138ms，最长 =163ms，平均 = 145ms
----

+
保持一段时间的输出内容后进行查看，若``时间``列不超过 100ms，且没有太大的波动，位置在某个范围内，则说明客户端到云平台公网 IP 的网络环境比较稳定；如果超过 100ms，则表示网络有较大延迟。

. 确认公网 IP 的带宽上限。
+
在 EIP 控制台查看公网 IP 的带宽上限。
+
image::/images/cloud_service/network/eip/high_ping1.png[high_ping]
+
如上图，该公网 IP 的带宽上限为 10Mbps。

. 查看公网 IP 的带宽监控数据，判断是否需要调整带宽。
+
image::/images/cloud_service/network/eip/high_ping2.png[high_ping]
+
如果有较高的进带宽，已经将 10Mbps 的带宽都占满，此时为了快速恢复 Web 服务器的正常访问，需要提高公网 IP 的带宽上限，来尽快完成数据的传输，等数据传输完毕，再将带宽调成原来的 10Mbps 即可。
+
image::/images/cloud_service/network/eip/high_ping3.png[high_ping]

. 如果没有下载或者上传，但是也出现了较高的带宽占用，则很有可能是有大量的业务访问。此时需要查看业务层日志，排查是否为正常的业务流量。
+
* 如果是正常业务流量，建议提升公网带宽。
* 如果是恶意攻击，可以在云服务器绑定的安全组对应端口添加一个优先级较高的拒绝规则，源 IP 填写日志中恶意访问业务的客户端 IP，然后重启业务服务来断开之前已经建立的连接。

[#q3]
== 如何实现云服务器 IPv6 公网访问？

有以下两种方式可以提供 IPv6 的公网访问，您可以根据自己的网络需求和偏好进行选择。

* 方式一：通过 VPC 的双栈网络 DHCP 获取到 IPv6 地址，然后通过控制台为 IPv6 分配公网带宽的方式来实现公网访问。该方案使 IPv6 网络同时具备公网和 VPC 内网的访问能力。具体操作，请参见link:../../manual/ipv6/outbind_ipv6/[云服务器 IPv6 接入公网]。
* 方式二：申请一个 IPv6 弹性 IP 并绑定到云服务器上，然后手动配置 IPv6 地址及路由以实现公网访问。该方案使 IPv6 网络只具有公网访问能力，无法与 VPC 内部的 IPv6 互通，类似于内网的 IPv4 是无法访问公网 IPv4。具体操作，请参见 link:../../manual/ipv6/inbind_ipv6/[IPv6 EIP 绑定到云服务器]。

