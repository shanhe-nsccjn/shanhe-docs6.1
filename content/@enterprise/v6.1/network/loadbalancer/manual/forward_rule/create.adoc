---
title: "创建转发策略"
description: 介绍如何创建转发策略。
keywords: 负载均衡器,转发策略,转发规则,重写规则
draft: false
weight: 10
linkkey: network_loadbalancer_info_manual
---
本文介绍如何创建转发策略。

== 背景信息

默认情况下，监听器根据监听协议及端口并按照分配策略，将访问请求转发给后端服务器。除此外，您还可以通过自定义转发策略进行更高级的转发控制。

== 操作步骤

=== 步骤一：创建转发策略

. 登录管理控制台，选择**产品与服务** > *网络* > *负载均衡器*，进入**负载均衡器**页面。
. 点击**转发策略**页签，进入**转发策略**页面。
+
image::/images/cloud_service/network/lb/create_forward_policy.png[,90%]

. 点击**创建**，弹出**创建转发策略**窗口。
. 配置转发策略参数。
+
[cols="1,3"]
|===
| 参数 | 说明

| 名称
| 转发策略名称。

| 匹配方式
a| 转发规则及重写规则的匹配方式：

* 匹配任意规则：匹配任意一条转发规则的请求都将被转发，即该策略下，规则之间为**或/OR**关系。
* 匹配所有规则：匹配所有规则的请求才会被转发，即该策略下，规则之间为**与/AND**关系。

| 优先级
| 转发策略优先级。 +
取值范围：[0,99]。值越小，优先级越高。多条策略绑定到后端时，先适用优先级高的。

| 健康检查
| 设置后端服务器的健康检查方式及健康检查选项。 +
关于健康检查设置的详细说明，请参考link:../../healthy/intro/[健康检查概述]。
|===

. 点击**提交**，进入转发策略详情页面。

=== 步骤二：添加转发规则

通过配置转发规则，可以将来自不同域名或者不同 URL 的请求转发到不同的后端服务器组处理。

. 在**转发规则**区域，点击**添加**，弹出**添加转发规则**窗口。
. 配置转发规则。
+
[cols="1,3"]
|===
| 参数 | 说明

| 名称
| 转发规则名称。

| 规则类型
| 支持``按域名转发``、`按 URL 转发`、`按源地址转发` 和 ``按 HTTP Header 转发``四种规则类型，您可以根据使用场景配置不同类型的转发规则。 +
规则类型详细说明，请参见link:../../forward_rule/intro/#_转发规则[转发规则说明]。

| 规则内容
| 表示需要匹配的请求值，符合该规则内容，则转发至指定的目标后端。 +
规则内容填写说明，请参见link:../../forward_rule/intro/#_转发规则[转发规则说明]。
|===

. 点击**提交**。
. 点击**应用修改**，使规则生效。

=== 步骤三：添加重写规则（可选）

通过配置重写规则，可以在请求转发给目标后端服务之前，修改原始请求的路径（Path）。

. 在**重写规则**区域，点击**添加**，弹出**添加转发规则**窗口。
. 配置重写规则。
+
[cols="1,3"]
|===
| 参数 | 说明

| 名称
| 转发规则名称。

| 规则类型
| 目前，仅支持按路径重写。即按照规则修改原始请求的路径。

| 规则内容
a| 重写规则固定表达式：`%[path,regsub(xx,yy,i)]`，表示把 URL 路径中的第一次出现的 `xx`（不区分大小写）替换为 `yy`。 +

* 除 `xx`, ``yy``可修改外，其余部分不能修改。
* ``xx``为匹配字符串， ``yy``为替换字符串，``i``表示不区分大小写。
* 表达式中不能含有空格，`xx`, ``yy``的取值中也不能有空格。

规则详细说明，请参见link:../../forward_rule/intro/#_重写规则[重写规则说明]。

| 优先级
a| 当前规则的优先级。 +
取值范围：[0,100]。值越小，优先级越高。

* 优先级相同时，按照规则添加的顺序依次执行。
* 多条重写规则时，按照优先级，上一条规则重写成功的输出，就是下一条重写的输入。
|===

. 点击**提交**。
. 点击**应用修改**，使规则生效。
