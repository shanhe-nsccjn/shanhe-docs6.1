---
title: "添加 HTTPS 监听器"
description: 介绍如何创建HTTPS监听器。
keywords: 负载均衡器,监听器,HTTPS
draft: false
weight: 11
---
您可以在负载均衡器实例上添加一个 HTTPS 监听器转发来自客户端的 HTTPS 协议请求。

== 适用场景

HTTP 协议适用于需要对请求的内容进行识别的应用，如 Web 应用、App 服务等。

== 前提条件

* 已link:../../lb/create_lb/[创建负载均衡器实例]。
* 已link:../../certificate/create_cert/[创建服务器证书]。

== 操作步骤

. 登录管理控制台，选择**产品与服务** > *网络* > *负载均衡器*，进入**负载均衡器**页面。
. 在负载均衡器列表，找到目标实例，点击实例 ID 号，进入实例详情页。
+
image::/images/cloud_service/network/lb/add_monitor.png[]

. 在**监听器**页签，点击**创建监听器**，弹出**添加监听器**页面。
+
image::/images/cloud_service/network/lb/add_https_monitor.png[]

. 配置监听器参数。
+
参数说明如下表。
+
[.allow_break_inside,cols="1,3"]
|===
| 参数 | 说明

| 名称
| 自定义监听器名称。

| 监听协议
| 客户端与负载均衡监听器建立流量分发连接的协议。 +
本操作中需选择 *HTTPS*。

| 端口
a| 用来接收请求并向后端服务器转发请求的端口。 +
取值范围为：[1-65535]。 +

include::../../../../../../_components/note_in_table.adoc[]
添加监听器后，需要在负载均衡器所属安全组中，放行监听端口下行流量，否则从外网无法访问您的服务。

include::../../../../../../_components/footer_in_table.adoc[]

| 负载方式
a| 选择负载均衡的调度算法。

* 轮询：依据后端服务器的权重，将请求轮流发送给后端服务器。
* 最少连接：优先将请求发给拥有最少连接数的后端服务器。
* 源地址：基于源 IP 地址的一致性哈希，相同的源地址会调度到相同的后端服务器。

| 服务器证书
| 点击**添加服务器证书**，选择已创建的证书。 +


| *高级选项*
| 点击**显示高级选项**，进行以下高级选项配置。

| 会话保持
| 选择是否启用会话保持。启用会话保持后，负载均衡将属于同一个会话的请求都转发到同一个服务器进行处理。

| 健康检查
| 设置健康检查方式及健康检查选项，以定期检查后端服务的运行状态。 +
关于健康检查设置的详细说明，请参考link:../../healthy/intro/[健康检查概述]。

| 场景
a| 监听场景。

* 默认优化：使用默认设置。
* keep-alive：通过 Connection 字段配置 Keep-Alive ，保证 HTTP 可以复用连接。

| 附加 HTTP 头字段
a| 负载均衡器在转发 HTTP 请求时可以附加用户指定的 HTTP 头字段，后端服务器可以通过解析相应的头字段来获取字段内容：

* 客户端真实 IP：对应的 HTTP 的头字段为 *X-Forwarded-For*。
* 负载均衡器 ID：对应的 HTTP 的头字段为 *QC-LB-ID*。
* 负载均衡器入口 IP：对应的 HTTP 的头字段为 *QC-LB-IP*。
* 负载均衡器监听协议：对应的 HTTP 的头字段为 *X-Forwarded-Proto*。

| 超时时间
| 连接请求超时时间。 +
如果在超时时间内一直没有访问请求，负载均衡器会中断当前连接，直到下一次请求到来时再重新建立新的连接。 +
取值范围为：10 ~ 86400。默认 50。单位：秒。

| 隧道超时时间
| 通过隧道连接的超时时间。 +
取值范围为：10 ~ 86400。默认 3600。单位：秒。

| 附加选项
a| * 取消 URL 验证：让负载均衡器可以接受不符合编码规范的 URL，例如包含未编码中文字符的 URL 等。

* 获取客户端 IP：也称为“透明代理”，启用后，后端服务器可以获取到客户端的真实 IP 地址。 +
* 数据压缩：使用 gzip 算法压缩文本数据，以减少网络流量。
* 禁用 HTTP 头字段 Proxy：安全起见，某些后端为 CGI 的 Web 应用需要在用户请求中禁用该字段来防止注入攻击。
* 启用 HTTP2.0：启用后，HTTP2 在负载均衡器上终结，负载均衡器与后端的 HTTP 版本仍为 HTTP 1.1。

include::../../../../../../_components/note_in_table.adoc[]

启用**获取客户端 IP**后，负载均衡器对于后端完全透明，后端云服务器 TCP 连接得到的源地址是客户端的 IP，而不是负载均衡器的 IP，会导致内网请求失败，请在只提供公网服务（绑定了公网 IP）时开启。

include::../../../../../../_components/footer_in_table.adoc[]

| 加密选项
| 选择需要启用或禁用的加密方式。 +
支持**启用安全的加密方式**、*禁用不安全的加密方式*、**启用兼容 IE 的加密方式**以及**启用全部加密方式**，具体每种选项所支持的加密方式请参考界面提示。

| 选择 TLS 版本
| TLS 协议版本，支持 TLSv1.0、TLSv1.1、TLSv1.2 和 TLSv1.3。 +
请确保客户端支持所选择的 TLS 版本，避免无法协商成功而带来的业务影响。
|===

. 配置确认无误后，点击**提交**，开始创建监听器。
+
创建成功后，您可以在监听器页面查看到已创建的监听器。

. 点击**应用修改**，更新负载均衡器配置。

== 关联操作

* link:../../backends/manage/[添加后端服务器]
* link:../../monitor/mge_monitor/[管理监听器]
