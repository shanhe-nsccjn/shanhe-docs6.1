---
title: "使用内网 DNS 功能"
description: 介绍如何配置 VPC 网络内部的 DNS 服务。
keywords: VPC, VPC 网络, 内网 DNS
draft: false
weight: 20
---


== 使用场景

对 VPC 内部提供域名解析的服务，可以开启/关闭内网 DNS 服务，同时支持开启/关闭 PTR 解析类型-反向 DNS 解析。

== 操作步骤

=== 1.开启功能

通过vpc详情界面--管理配置--dns服务--打开dns服务，可以参考截图

image::/images/cloud_service/network/vpc/openvpn_dns_push_03.png[,60%]

=== 2.应用修改vpc网络

image::/images/cloud_service/network/vpc/openvpn_dns_push_04.png[,60%]

=== 3.添加内网 DNS 解析，并应用修改

image::/images/cloud_service/network/vpc/openvpn_dns_push_05.png[,60%]

=== 4.验证DNS解析是否生效
[source]
----
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.030 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.059 ms
64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.058 ms
^C
--- localhost ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 1999ms
rtt min/avg/max/mdev = 0.030/0.049/0.059/0.013 ms
[root@i-b6s3dvje ~]# ping test
ping: test: Name or service not known
[root@i-b6s3dvje ~]#
----

== 问题排查

如内网dns配置没有生效，可以参考以下办法进行解决。

. 重启云服务器的网络。
+
[source]
----
systemctl restart networking
----

. 离开私有网络，重新加入
. 重启云服务器
+
或者手动更改dns配置，参考格式如下

+
[source]
----
[root@i-tqzv58ti ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search localdomain jn1.shanhe.com
nameserver 172.20.255.254
----

